<!DOCTYPE html>
<!--
 * Copyright © 2018, Oracle and/or its affiliates. All rights reserved.
 *
 * The Universal Permissive License (UPL), Version 1.0
 * https://oss.oracle.com/licenses/upl
 -->
<html lang="en">

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <!-- Part number: E95689-01 -->
    <!-- Published date: Feb 2019 -->
    <!-- Template date: October 15, 2018 -->
    <!-- Put the content ID of this OBE between the empty quotation marks for 'content' below -->
    <meta name="contentid" content="">
    <!-- The title below is displayed on the browser tab, in search results, and in  history. It can be longer than the tutorial title in the <h1> element, below.-->
    <!-- Use an imperative verb in the title. -->
    <title>Real-World Entity Extraction</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="robots" content="INDEX, FOLLOW">
    <meta name="description" content="Using Composite bag for real world entity extraction.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/normalize.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/obe-lite.css">
    <script src="js/jquery-1.11.0.min.js"></script>
    <script src="js/jquery-ui-1.10.4.custom.js"></script>
    <script src="js/jquery.tocify.jd.js"></script>
    <script src="js/leftnav.js"></script>
    <style type="text/css">
        < !-- .style1 {
            color: #FF0000
        }

        -->

    </style>
</head>

<body>
    <header>
        <div class="w1024" style="min-height:55px; display:block;"> <a href="https://docs.oracle.com" class="oracle-logo"> <img src="img/oracle_doc_logo.png" alt="Oracle Documentation" style="max-width: none;" height="22" width="236"></a> </div>
    </header>
    <!--end header-->
    <div id="content">
        <!-- The title below is displayed as the title at the top of the OBE page. It can be shorter than the title in the <title> element, above. -->
        <!-- Use an imperative verb in the title. -->
        <h1><img src="img/obe_tag.png" alt="Oracle by Example branding" align="middle">Using
            Composite Bag Entities for Real-World Entity Extraction</h1>
        <div class="w1024" style="clear:both; position:relative; margin-top:40px;">
            <div class="navbackwide border-right">
                <!-- -->
            </div>
            <div id="shownav" title="Show Navigation" tabindex="0"><span class="fa fa-list"></span></div>
            <div id="sidebar">
                <!-- -->
                <div class="left-nav-tut">
                    <!-- -->
                    <div id="hidenavw" title="Hide Navigation" tabindex="0"><span class="fa fa-close"></span></div>
                    <div id="navbar" class="left-nav-w">
                        <!-- -->
                        <div id="toc" class="tocify">
                            <!-- -->
                        </div>
                    </div>
                </div>
            </div>
            <div id="bookContainer">
                <article>
                    <p style="text-align:justify"><span lang="EN-US"><b>
                                <font size="+1">Tutorial by Grant Ronald</font></b><font size="+1"><b>, Oracle</b></font><br>
                            March 2019, Oracle Digital Assistant version 19.1.3<br><br>
                        </span></p>
                    <section>
                        <h2><img src="img/32_begin.png" alt="section 0" class="num_circ" height="32" width="32">Before You Begin</h2>
                        <p>This 45 minute tutorial shows how you can easily add value-setting logic with the composite bag entity.</p>
                        <h3>Background</h3>
                        <p>In this tutorial, you're working with a skill for ordering pizzas that has a basic dialog flow definition along with some intents and entities for extracting values for the pizza order, delivery address, and delivery location. By adding a composite bag entity to these building blocks, you can create a pizza skill that allows spontaneous, real-world interactions without having to implement custom code or write a complex and lengthy dialog flow definition. How and when the composite bag sets the values for these entities depends on the circumstance. When customers change their orders midway through the conversation, for example, the skill can gracefully update the previously extracted value and continue on without forcing them to begin their orders all over again. The skill can prompt for values when they're not included in the customer input and can validate this input as well, sending context-specific error messages when it's incorrect. </p>

                        <h3>What Do You Need?</h3>
                        <ul>
                            <li>Access to an Oracle Digital Assistant instance.</li>
                            <li>The <code>PizzaBot_Materials.zip</code> file, which includes the starter skill, reference files, and a finished version of the skill. Click <a href="./files/PizzaBot_Materials.zip" target="_blank">here</a> to download this file and then unzip it to your local system.</li>
                        </ul>
                    </section>
                    <!-- ========================================================================================================================= -->
                    <section>
                        <hr>
                        <h2 id="section_1" role="button" style="text-align: left;"> <img src="img/32_1.png" alt="section 1" class="num_circ" height="32" width="32">Explore the Starter Skill</h2>
                        <p>The first thing you need to do is import the starter pizza skill into your Oracle Digital Assistant instance so that you can see what you're working with. </p>
                        <div>
                            <h3>Import the Starter Skill</h3>
                            <ol>

                                <li>Log into Oracle Digital Assistant.</li>
                                <li>Click <img src="img/menu.png" alt="menu icon" title="menu">
                                    in the top left corner to open the side menu.</li>
                                <li>Expand <strong>Development</strong> and
                                    then click <strong>Skills</strong>. </li>
                                <li>Hide them menu by clicking <img src="img/menu.png" alt="menu icon" title="menu">
                                    again. </li>
                                <li>Click <strong>Import Skill</strong>
                                    (located at the upper right).
                                    <figure><img src="./img/Import%20Skill.png" alt="An image of Skills dialog box with the Import Skill button highlighted." title="Import Skill Dialog">
                                        <figcaption><a href="files/Import%20Skill.txt">Description
                                                of the illustration.</a></figcaption>
                                    </figure>
                                </li>
                                <li>Browse to, and then select, <code>
                                        CompositeBagTutorial_Starter.zip</code>. Then click <strong>Open</strong>. </li>
                            </ol>
                        </div>
                        <div>
                            <h3> Explore and Test the Skill</h3>
                            <p>Take a look at the intents and entities.</p>
                            <ol>
                                <li>In the dashboard, click the CompositeBag_Tutorial_Starter tile to open skill in the Skill Builder. The intent editor should be selected when this development environment is launched. If it isn't, click <strong>Intents</strong> (<img src="./img/intents_icon.png" alt="Intent icon" title="Intent icon">) in the left navbar. </li>
                                <li>Click the <strong>OrderPizza </strong>intent and take a look at its utterances.</li>
                                <li>Click <strong>Entities</strong> (<img src="img/entities_icon.png" alt="Entities Menu Icon" title="Entities Menu Icon">) in the left navbar.</li>
                                <li>Click the PizzaDough, PizzaSize,
                                    PizzaTopping, and NamedLocation entities. Take a look at the values and synonyms defined for each of these Value List entities. Notice that PizzaTopping and PizzaSize entities both have prompts.<br>
                                    <figure><img src="./img/pizza%20entities%20list.png" alt="An image of the list of entities associated wiith the Pizza entity." title="Import Skill Dialog">
                                        <figcaption><a href="files/pizza%20entities%20list.txt">Description of the illustration.</a></figcaption>
                                    </figure>
                                </li>
                                <li>Click <strong>Flows</strong> (<img src="./img/dialog_flow_icon.png" alt="Dialog flow editor icon" title="Dialog flow editor icon">) in the left navbar.
                                    Notice that at this point it is just a basic flow. Were going to add the code to resolve the various pizza variables in a minute.
                                <li>Click <strong>Train</strong> (located ) on the right side of the top menu.<br>
                                    <img src="./img/train_button.png" alt="The Train button" title="Train button icon"> </li>
                                <li> Accept the default selections in the Train dialog and then click
                                    <strong> Submit</strong>. </li>
                                <li>Click the Skill Tester in the left navbar.<br>
                                    <img src="./img/tester.png" alt="Skill Tester icon" title="Skill Tester icon"></li>
                                <li>In the chat window, enter <i>I want a pizza</i> and then click Enter<strong></strong>. The skill replies with the placeholder message, <em>This is where you will see the pizza order</em> that's the value for the <code>showPizzaOrder</code> component. Throughout this tutorial, you'll update this message with Apache FreeMarker expressions that allow it to display specific entity values.<br>
                                </li>
                                <li>Click <strong>Reset</strong> (located at the upper left of the Skill Tester) to clear your input and then <strong>Close</strong> (<img src="./img/close_icon.png" alt="The Close icon" title="Close Icon">). </li>
                            </ol>
                            <p> <strong>What you just did:</strong> You've imported the basic skill into your instance and tested it to find out if its intent, entity, and dialog flow definitions are valid. </p>
                        </div>
                    </section>
                    <hr>
                    <section>
                        <h2 id="section_2" role="button" style="text-align: left;"><img src="img/32_2.png" alt="section 2" class="num_circ" height="32" width="32">Create the Basic Composite Bag Entity</h2>
                        <p> The first step is to create the composite bag itself, add the PizzaSize and PizzaType entities to it, and then add context-specific prompts and input validators for these entities.</p>
                        <div>
                            <h3>Create the Composite Bag Entity</h3>

                            <ol>
                                <li>Click the <strong>Entities</strong> (<img src="img/entities_icon.png" alt="Entities Menu Icon" title="Entities Menu Icon">) in the left navbar and then
                                    click <strong>+ Entity</strong>.</li>
                                <li>Change the entity name from <em>Entity1</em> to PizzaBag.</li>
                                <li>Choose <strong>Composite Bag</strong>
                                    from the Type menu.<br>
                                    <figure> <img src="./img/pizza%20entities%20configuration.png" alt="An image of the of the configuration dialog specifying the name and configuration type of the PizzaBag entity." title="Import Skill Dialog">
                                        <figcaption><a href="files/pizza%20entities%20configuration.txt">Description of the illustration.</a></figcaption>
                                    </figure>
                                </li>
                                <li>Click <strong>+ Bag item</strong>.</li>
                                <li>In the Name field, replace <em>BagItem1</em> with PizzaSize.</li>
                                <li>Choose <strong>PizzaSize</strong> from the Entity Name list.</li>
                                <li>The PizzaBot Skill needs to resolve the size of a pizza, but it also needs to output error messages when customers continually reply with values that can't be resolved by the PizzaSize entity's list items or synonyms. To do this, first increment <strong>Maximum User Input Attempts</strong> to 3.</li>
                                <li>Replace the existing error message (<em>Oops I didn't understand, I need a pizza size of small, medium or large</em>) with <em>Sorry, this is not a valid pizza size</em>.</li>
                                <li>Next, add a sequence of prompt messages that correspond to the allotted input attempts. Each of these messages becomes more emphatic as the sequence progresses. The skill already has the first one (What size pizza would you like?), but it doesn't have a sequence number. To add one, click <strong>Edit</strong> (<img src="img/edit_icon.png" alt="The Edit Icon">) , enter 1 and then click Enter.</li>
                                <li>Click <strong>Add Prompt</strong>.</li>
                                <li>Enter <em>Please choose small, medium, or large</em>.</li>
                                <li>Click <strong>Add Prompt</strong>.</li>
                                <li>Enter <em>OK! Let's have one more got at this. I just need you to select a pizza size. We offer large, medium and small</em>.
                                    <figure>
                                        <img src="./img/prompts.png" alt="An image of the of prompt sequence." title="Add Prompts">
                                        <figcaption><a href="files/prompts.txt">Description of the illustration.</a></figcaption>
                                    </figure>
                                </li>
                                <li>Click <strong>Close</strong>.</li>
                                <li>The skill resolves the topping type with its PizzaTopping entity. In addition to extracting this value, the skill needs check that the customers has selected only one topping. No substations allowed! Before you can add this validation to the PizzaTopping entity, you need to add it to the composite bag. Click <strong>+ Bag item</strong>.</li>
                                <li>Replace <em>BagItem1</em> with PizzaTopping in the Name field, then select <strong>PizzaTopping</strong> from the Entity Name list.</li>
                                <li>Switch on <strong>Prompt for Disambiguation</strong>.</li>
                                <li>In the Disambiguation Prompt field, enter <em>Sorry, you can only order one topping type</em>.<figure><img src="./img/disambiguation_prompt.png" alt="An image of the Disambiguation Resolution options." title="Disambiguation Resolution">
                                        <figcaption><a href="files/disambiguation_prompt.txt">Description of the illustration.</a></figcaption>
                                </li>
                                <li>Click <strong>Close</strong>.</li>
                            </ol>
                            <p><strong>What you just did: </strong>You have created a
                                composite bag entity that resolves pizza size and
                                pizza topping through context-specific prompts and error messages.</p>
                        </div>
                        <!--- Associate entity to intent -->
                        <div>
                            <h3>Associate The Composite Bag Entity to an Intent</h3>
                            <p>In this step, you will add the composite bag entity to the OrderPizza intent to enable the skill to parse the entity values with the intent.</p>
                            <ol>
                                <li>Select the intent icon (<img src="img/intents_icon.png" alt="Intents Menu Icon" title="Intents Menu Icon">).</li>
                                <li>Select the OrderPizza intent and then click <strong>+ Entity</strong>.</li>
                                <li>Select <strong>PizzaBag </strong>from the list.</li>
                                <li>Retrain the skill.<br>
                                    <figure> <img src="./img/pizza%20bag%20entity.png" alt="An image of the of the configuration dialog specifying the name and configuration type of the PizzaBag entity." title="Import Skill Dialog">
                                        <figcaption><a href="files/pizza%20bag%20entity.txt">Description of the illustration.</a></figcaption>
                                    </figure>
                                </li>
                            </ol>
                        </div>
                        <!--- Implement Pizza Ordering Logic -->
                        <div>
                            <h3>Update the Dialog Flow to Reference the Composite Bag Entity</h3>
                            <p>Next, update the dialog flow with the PizzaBag entity. You need to declare a context variable for this entity and also add a definition for the <code>System.ResolveEntities</code> component, which tracks the values set for the setting for the entities in the PizzaBag.</p>
                            <ol>
                                <li>Click <strong>Flows</strong> (<img src="./img/dialog_flow_icon.png" alt="Dialog flow editor icon" title="Dialog flow editor icon">) in the left navbar. </li>
                                <li>In the editor, add a new context variable for the PizzaBag entity by entering <code>pizza: &quot;PizzaBag&quot;</code> directly beneath the <code>iResult</code> variable. Be sure to align this entry with the <code>iResult</code> variable (which is indented by four spaces):<br>
                                    <pre>context:
  variables:
    iResult: "nlpresult"
    pizza: "PizzaBag"   
                    </pre>
                                </li>
                                <li>Click <strong>Validate</strong> to make sure that you've indented this entry correctly.</li>
                                <li>Uncomment the <code>resolveEntities</code> state, which contains the <code>System.ResolveEntities</code> component:
                                    <pre>  resolveEntities:
    component: "System.ResolveEntities"
    properties:
      variable: "pizza"
      nlpResultVariable: "iResult"      
      maxPrompts: 5
      cancelPolicy: "immediate" 
    transitions:
      actions:
        cancel: "maxError"
        next: "showPizzaOrder"</pre>
                                </li>
                                <li>Click <strong>Validate</strong> to check the indentation.</li>
                                <li>Take note of the <code>cancelPolicy</code> property and the <code>cancel</code> action that handle the customer replies that don't provide the kind of values needed to resolve all of the entities within the composite bag, or is completely off-topic. When the input is valid, the <code>System.ResolveEntities</code> component routes to the <code>showPizzaOrder</code> state.</li>

                                <li>In the <code>showPizzaOrder</code> state, replace the <code>text</code> property definition (<code>&quot;This is where you will see the pizza order.&quot;</code>) with a confirmation message, one that returns the entity values using Apache FreeMarker expressions:<br>
                                    <code>"Ok, so we are getting you a ${pizza.value.PizzaSize?lower_case} ${pizza.value.PizzaTopping?capitalize} pizza."</code>
                                    <p>When you're done, the <code>showPizzaOrder</code> state should look like this:
                                        <pre>showPizzaOrder:
    component: "System.Output"
    properties:
      text: "OK, so we are getting you a ${pizza.value.PizzaSize?lower_case} ${pizza.value.PizzaTopping<code>?capitalize</code>} pizza."
    transitions: 
      return : "showPizzaOrder"</pre>
                                    </p>
                            </ol>
                        </div>
                        <!--- Validate and Train PizzaSkill-->
                        <div>
                            <h3>Validate the Updated Pizza Skill</h3>
                            <p>Let's validate the changes and retrain the skill.</p>
                            <ol>
                                <li>Click <strong>Validate</strong> to check the indentation. If you're encountering syntax errors that you can't fix, replace the entire the dialog flow definition with the one in the <a href="./files/first_cb_dialog_flow.txt" target="_blank">first_cb_dialog_flow.txt file </a> and try validating again.</li>
                                <li>Click <strong>Train</strong>. </li>
                                <li>Accept the default selections in the Train dialog and then click
                                    <strong> Submit</strong>. Wait a moment for the training to complete.</li>
                            </ol>
                        </div>
                        <!--- Testing the basic Pizza Composite bag -->
                        <div>
                            <h3>Test the Entity Resolution</h3>
                            <p>Let's test the logic that we've configured for the PizzaSize and PizzaTopping entities and the updated dialog flow.</p>
                            <ol>
                                <li>Open the Skill Tester in the left navbar.</li>
                                <li>In the chat window, enter <em>I want to order a medium pizza</em>. </li>
                                <li>When prompted, enter a pizza type and then confirm that both this entity value and medium are included in the confirmation message. Click <strong>Reset</strong>.</li>
                                <li>Enter both entity values in the same request by entering <em>I want to order a large veggie pizza</em>. The skill should reply with the confirmation message, which includes both of the entity values. Click <strong>Reset</strong>.</li>
                                <li>Try out the error messages by first entering <em>I want to order a pizza</em>.</li>
                                <li>When prompted for a pizza size, enter a invalid value like <em>huge</em>.</li>
                                <li>Enter <em>massive</em>.</li>
                                <li>Enter <em>monster</em>. The skill should reply with the error message and with all three prompt messages. When you've reached the third attempt (the number you set for the <strong>Maximum User Input Attempts</strong> property), the <code>System.ResolveEntities</code> component triggers the <code>cancel</code> transition, routing you to <code>maxError</code> state. At this point, the skill outputs "OK! Let's connect you with someone to help!" This is just an output message; there's no skill-human agent integration configured for this skill.</li>
                                <li> Click <strong>Reset</strong>.<br>
                                </li>
                                <li>Next, test the value disambiguation by entering two different topping types in one message. For example, enter <em>I want to order a meaty veggie pizza</em>. The skill recognizes the invalid input by replying with "Sorry, you can only order one topping type</em>.&quot;</li>
                                <li>Click <strong>Reset</strong>, then close the Tester.</li>
                            </ol>
                            <ol>
                            </ol>
                        </div>
                    </section>
                    <hr>
                    <section>
                        <h2 id="section_3" role="button" style="text-align: left;"><img src="img/32_3.png" alt="section 3" class="num_circ" height="32" width="32">Set a Default Value</h2>
                        <p> Now that the basic composite bag implementation works, you can set a default value for the PizzaDough entity. This entity extracts values for two types of dough: regular and gluten-free. To speed the ordering process, we'll assume that most customers prefer regular crust. This will be the default value that's set for the PizzaDough entity. But when customers request gluten-free, the skill updates the PizzaDough entity value. The change is seamless (and invisible) to customers because they receive no prompts or confirmation messages. The crust request is noted and the composite bag prompts for the next entity. For your skill to handle this change, you need to configure the PizzaDough entity to accept gluten-free as an optional value.</p>
                        <ol>
                            <li>Click <strong>Entities</strong> (<img src="img/entities_icon.png" alt="Entities Menu Icon" title="Entities Menu Icon">) in the left navbar, then select the PizzaBag entity.</li>
                            <li>Click <strong>+ Bag item</strong>, then replace <em>BagItem1</em> with <em>PizzaDough</em>.</li>
                            <li>Select <strong>PizzaDough</strong> from the Entity Name list.</li>
                            <li>In the Extraction Rule section, ensure that <strong>Out of Order Extraction</strong> is switched on. </li>
                            <li>Enter <code>False</code> in the Prompt for Value field.</li>
                            <li>Click <strong>Close</strong>.<br>
                            </li>
                            <li>Click <strong>Train</strong>. </li>
                        </ol>
                        <p><strong>What you just did</strong>: You've enabled the composite bag to accept customer input that overwrites a default value.</p>
                        <!--- Implement default value in the dialog flow -->
                        <div>
                            <h3>Implement the Default Value Logic in the Dialog Flow</h3>
                            <p>Because gluten-free is the exception, not the rule for most of the skill's customers, you need to update the dialog flow that sets the default value, regular. </p>
                            <ol>
                                <li>Click <strong>Flows</strong> (<img src="./img/dialog_flow_icon.png" alt="Dialog flow editor icon" title="Dialog flow editor icon" style="
                    height: 32px;"> ) in the left navbar.</li>
                                <li>Update the transition routing in the resolveEntities state by replacing <code>next: &quot;showPizzaOrder&quot;</code> with <code>next: "setPizzaDough"</code>. <p>When you're done, the <code>resolveEntities</code> state should look like this:
                                        <pre>  resolveEntities:
    component: "System.ResolveEntities"
    properties:
      variable: "pizza"
      nlpResultVariable: "iResult"      
      maxPrompts: 5
      cancelPolicy: "immediate" 
    transitions:
      actions:
        cancel: "maxError"
        next: "setPizzaDough"</pre>
                                    </p>
                                <li>You've now defined that when the composite bag has resolved all of the values, the dialog will then navigate to the <code>setPizzaDough</code> state. This state keeps the valid values for the PizzaRough entity. When these values aren't valid, then it uses the regular value. Add this state directly after the <code>resolveEntities</code> state.
                                    <pre>  setPizzaDough:
    component: "System.SetVariable"
    properties:
      variable: "pizza.PizzaDough"
      value: "${pizza.value.PizzaDough?has_content?then(pizza.value.PizzaDough,'regular')}"</pre>
                                </li>
                                <li>Update <code>text</code> property in the <code>showPizzaOrder</code> state to include the dough type by adding <code>This will be on our ${pizza.value.PizzaDough} crust</code>.
                                    <p>When you're done, the showPizzaOrder state should look like this:
                                        <pre>  showPizzaOrder:
    component: "System.Output"
    properties:
      text: "OK, so we are getting you a ${pizza.value.PizzaSize?lower_case} ${pizza.value.PizzaTopping??capitalize} pizza. This will be on our ${pizza.value.PizzaDough} crust."
    transitions: 
      return : "showPizzaOrder"</pre>
                                    </p>
                                </li>
                                <li>Click <strong>Validate</strong> to check for indentation and syntax errors. If you're encountering problems that you can't fix, replace the dialog definition with <a href="./files/second_cb_dialog_flow.txt" target="_blank">second_cb_dialog_flow.txt file</a>.</li>
                                <li>Retrain your skill.</li>
                            </ol>
                        </div>
                        <!--- Testing the Default Values -->
                        <div>
                            <h3>Testing Default Values</h3>
                            <p>Test the new functionality:</p>
                            <ol>
                                <li>Open the Skill Tester in the left navbar.</li>
                                <li>Enter <em>I want to order a large veggie pizza.</em>
                                    The skill confirms your order with regular crust.<strong><br>
                                    </strong></li>
                                <li>Enter <em>I want to order a veggie gluten-free pizza</em>.
                                    The skill prompts you for the size. After you select that, the order confirmation includes gluten-free crust.</li>
                                <li>Click <strong>Reset</strong>, then close the Tester.</li>
                            </ol>
                            <p><strong>What you just did</strong>: You configured the PizzaDough entity so that it can accept an optional value. In the dialog flow, you added a Apache FreeMarker expression that sets regular as default crust type using the <code>has_content</code> and <code>then</code> operators. </p>
                        </div>
                    </section>
                    <hr>
                    <section>
                        <h2 id="section_4" role="button" style="text-align: left;"><img src="img/32_4.png" alt="section 4" class="num_circ" height="32" width="32">Validate the
                            Delivery Time</h2>
                        <p> Part of the pizza ordering process is allowing customers to specify their preferred delivery time. But this PizzaBot doesn't offer 24-hour delivery--it must recognize when customers request a
                            delivery time that's outside of normal business
                            hours and then prompt for valid time. There's no existing entity to recognize time, so you're going to add one to the bag. Unlike the existing entities, this entity is not a Value list. It's based on the built-in TIME entity that recognizes hours, minutes and seconds.</p>
                        <ol>
                            <li>Click <strong>Entities</strong> (<img src="img/entities_icon.png" alt="Entities Menu Icon" title="Entities Menu Icon">) in the left navbar, the select the PizzaBag entity. </li>
                            <li>Click <strong>+ Bag item</strong>, then replace <em>BagItem1</em> with <em>DeliveryTime</em>.</li>
                            <li>Select <strong>TIME</strong> from the Entity Name list.</li>

                            <li>Increment <strong>Maximum User Input Attempts</strong> to 3.</li>
                            <li>Add two prompts. Enter <em>When can we deliver that for you?</em> for the first prompt in the sequence. For the second, enter <em>If you can, let us know the delivery time. We close by 10pm</em>.</li>
                            <li>Click <strong>Add Validation Rule</strong>.</li>
                            <li>Enter <code>${(pizza.value.DeliveryTime.hrs?number &lt;
                                    10)?then('true','false')}</code> in the Expression field. </li>
                            <li>In the Error Message field, entry <em>Sorry, we only offer delivery up to 9:30 pm</em>.<br>
                                <figure>
                                    <img src="./img/time_prompts_errors.png" alt="An image of the of the DeliveryTime prompts and error messages." title="Import Skill Dialog">
                                    <figcaption><a href="files/time_prompts_errors.png.txt">Description
                                            of the illustration.</a></figcaption>
                                </figure>
                            </li>
                            <li>Click <strong>Close</strong>.</li>
                            <li>Retrain the skill.</li>
                            <li>Click <strong>Flows</strong> (<img src="./img/dialog_flow_icon.png" alt="Dialog flow editor icon" title="Dialog flow editor icon"> ) in the left navbar.</li>
                            <li>Update the confirmation message to output the customer's delivery time by adding the following to the <code>text</code> property (after the <code>PizzaTopping</code> expression):
                                <p>
                                    <code>at ${pizza.value.DeliveryTime.date?long?number_to_time?string.short}</code></p>
                                When you're done, the <code>text</code> property definition should look like this:
                                <p>
                                    <code>"OK, so we are getting you a ${pizza.value.PizzaSize?lower_case} ${pizza.value.PizzaTopping?capitalize} pizza at ${pizza.value.DeliveryTime.date?long?number_to_time?string.short}.This will be on our ${pizza.value.PizzaDough} crust."</code></p>
                                <p>The <code>showPizzaOrder</code> state should look like this:
                                    <pre>  showPizzaOrder:
    component: "System.Output"
    properties:
      text: "OK, so we are getting you a ${pizza.value.PizzaSize?lower_case} ${pizza.value.PizzaTopping?capitalize} pizza at ${pizza.value.DeliveryTime.date?long?number_to_time?string.short}. This will be on our ${pizza.value.PizzaDough} crust."
    transitions: 
      return : "showPizzaOrder"
</pre>
                                </p>
                            </li>
                            <li>Click <strong>Validate</strong> to check for indentation and syntax errors.</li>
                        </ol>
                        <!--- Testing validation -->
                        <div>
                            <h3>Test the Date Validation</h3>
                            <p>Test how the skill recognizes valid delivery times based on the logic</p>
                            <ol>
                                <li>Open the Skill Tester in the left navbar.</li>

                                <li>Enter <em>I want to order a large veggie pizza</em>. The skill replies with "When can we deliver that for you?" (the first prompt in the sequence).</li>
                                <li>Enter <em>10</em> (omitting the am and pm). The skill replies with the second prompt, "If you can, let us know the delivery time. We close by 10pm."</li>
                                <li>Enter <em>10pm</em>. The skill replies with your error message, "Sorry, we only offer delivery up to 9:30 pm."</li>
                                <li>Enter a valid time, like <em>8pm</em>. The skill notes the delivery time in the confirmation message.</li>
                                <li>Click <strong>Reset</strong>, then close the Tester.</li>
                            </ol>
                            <p><strong>What you just did</strong>: You configured the DeliveryTime entity so that it not only prompts for a delivery time, but also validates that input because of the comparison operators in the Apache FreeMarker expression.
                                You also updated the dialog flow with another
                                Apache FreeMarker expression that formats the customer input using a combination of the built-in <code>date</code>, <code>long</code>, and <code>number_to_time</code> operations.</p>
                            <hr>
                            <section>
                                <h2 id="section_5" role="button" style="text-align: left;"><img src="img/32_5.png" alt="section 5" class="num_circ" height="32" width="32">Extract Entity Values When They're Entered Out-of-Order</h2>
                                <p> Customers shouldn't have to start over when they change their orders. In this step, you configure the entities and the dialog flow , you can implement functionality within the entities and the dialog that will understand
                                    if the user re-enters any entity value and to update that value
                                    and acknowledge to the users input.</p>
                                <ol>
                                    <li>Click <strong>Entities</strong> (<img src="img/entities_icon.png" alt="Entities Menu Icon" title="Entities Menu Icon">) in the left navbar, then select the PizzaBag entity.</li>


                                    <li>Make sure that <strong>Out of Order Extraction</strong> is switched on for both the PizzaSize and PizzaToppings entities. Click <strong>Edit</strong> (<img src="img/edit_icon.png" alt="The Edit Icon">) to open these entities.</li>
                                    <li>Click <strong>Close</strong> after you've checked the entities.</li>
                                </ol>
                                <p><strong>What you just did</strong>: By ensuring that the <strong>Out of Order Extraction</strong> option is set for both of these entities, you've given the composite bag the flexibility to reset values. Here, the <strong>Out of Order Extraction</strong> option allows the skill to replace the existing pizza size value. It can be reset at any point. </p>
                                <!--- Testing out of order entity extraction -->
                                <div>
                                    <h3>Test Out-of-Order Entity Extraction for the Pizza Size and Pizza Topping Values</h3>
                                    <p>Let’s test how this functionality works. </p>
                                    <ol>
                                        <li>Open the Skill Tester in the left navbar.</li>
                                        <li>Enter <em>I want to order a large pizza</em>.</li>
                                        <li>When prompted for pizza topping, enter <em>veggie
                                                please, but can you make it a medium</em>. </li>
                                        <li>Complete the order process. Make sure that the confirmation message includes <em>medium pizza</em>, not <em>large</em>. </li>
                                    </ol>
                                </div>
                                <!--- Immediate confirmation of entity value change -->
                                <div>
                                    <h3>Configure the Immediate Confirmation of the Value Change</h3>
                                    <p>Now that you have configured the logic within the composite bag entity to update the pizza size value, you need to skill to immediately acknowledge this change. To do this, you need to add functionality that will confirm the change before prompting for the next item value.</p>
                                    <p>First, add descriptions for the PizzaBag and PizzaSize entities:</p>
                                    <ol>
                                        <li>Click <strong>Entities</strong> (<img src="img/entities_icon.png" alt="Entities Menu Icon" title="Entities Menu Icon">) in the left navbar, then select the PizzaBag entity.</li>

                                        <li>For the PizzaSize entity, enter <em>size of pizza</em> in the Description field. Then click <strong>Close</strong>.</li>
                                        <li>For the PizzaTopping entity, enter <em>pizza topping</em> in the Description field. Then click <strong>Close</strong>.</li>
                                    </ol>
                                    <p>Next, update the <code>resolveEntities</code> state:</p>
                                    <ol>
                                        <li>Click <strong>Flows</strong> (<img src="./img/dialog_flow_icon.png" alt="Dialog flow editor icon" title="Dialog flow editor icon"> ) in the left navbar.</li>
                                        <li>In the <code>resolveEntities</code> state, update the <code>System.ResolveEntities</code> component with the following <code>headerText</code> property:<p>headerText: "&lt;#list system.entityToResolve.value.updatedEntities&gt;I have updated the &lt;#items as ent&gt;${ent.description}&lt;#sep&gt; and &lt;/#items&gt;. &lt;/#list&gt;" </p>
                                            <p>When you're done, the resolveEntities state should look like this:
                                                <pre>  resolveEntities:
    component: "System.ResolveEntities"
    properties:
      variable: "pizza"
      nlpResultVariable: "iResult"      
      maxPrompts: 5
      headerText: &quot;&lt;#list system.entityToResolve.value.updatedEntities&gt;I have updated the &lt;#items as ent&gt;${ent.description}&lt;#sep&gt; and &lt;/#items&gt;. &lt;/#list&gt;&quot; 
      cancelPolicy: "immediate" 
    transitions:
      actions:
        cancel: "maxError"
        next: "setPizzaDough"</pre>
                                        </li>
                                        </p>
                                        <li>Click Validate to check for indentation and syntax errors.</li>
                                    </ol>
                                    <p><strong>What you just did</strong>: You added entity descriptions that are mined by the Apache FreeMarker directive that defines the <code>headerText</code> property. The <code>list</code> directive iterates through the entities using the <code>system.entityToResolve.value.updatedEntities</code> system variable. The values are stored using the <code>ent</code> loop variable. The skill displays the header message that confirms the change before it prompts the customer for the next entity in the composite bag.</p>
                                </div>
                                <!--- ITesting confirmation of out of order entity extraction -->
                                <div>
                                    <h3>Test the Confirmation Alert</h3>
                                    <p>Let’s test how this functionality works. </p>
                                    <ol>
                                        <li>Open the Skill Tester.</li>
                                        <li>Enter <em>I want to order a large pizza</code></em>.</li>
                                        <li>Enter <em>veggie please, but can you make it a medium</em>. The skill replies with "I have updated the size of pizza."</li>
                                    </ol>
                                </div>
                            </section>
                            <hr>
                            <section>
                                <h2 id="section_6" role="button" style="text-align: left;"><img src="img/32_6.png" alt="section 6" class="num_circ" height="32" width="32">Allowing
                                    Related Terms for an Entity Value</h2>
                                <p> In addition the delivery time and the pizza itself, the pizza bot needs values for the delivery address. To capture these values, the skill already has a Value List entity called NamedAdress, which represents the different ways a user might realistically refer to an address without actually specifying the physical address. In addition to these list items, the skill needs a second entity that allows it to recognize an actual street address. On top of that, it needs to resolve both of these related entities using a single user message. A message containing <em>home</em>, for example, resolves both entities, for example.</p>
                                <p>First, create the entity for the street address and then add it to the composite bag:</p>
                                <ol>
                                    <li>Click <strong>Entities</strong> (<img src="img/entities_icon.png" alt="Entities Menu Icon" title="Entities Menu Icon">) in the left navbar, then select the PizzaBag entity.</li>
                                    <li>Click <strong>+ Bag item</strong>.</li>
                                    <li>Replace <em>BagItem1</em> with <em>DeliveryAddress</em>.</li>
                                    <li>Select <strong>ADDRESS</strong> from the Entity Name list.</li>
                                    <li>Enter <code>${!pizza.value.NamedLocation?has_content}</code>in the Prompt for Value field.<br>
                                        <figure> <img src="./img/prompt_for_extraction.png" alt="An image of the of the DeliveryAddress Out of Order Extraction option." title="Import Skill Dialog">
                                            <figcaption><a href="files/time_prompts_errors.png.txt">Description
                                                    of the illustration.</a></figcaption>
                                        </figure>
                                    </li>
                                    <li>Click<strong> Add Prompt</strong> and then enter <em>What address can we send that to?</em></li>
                                    <li>Click <strong>Close</strong>.</li>
                                </ol>
                                <p>Next, add the NamedLocation entity to the bag:</p>
                                <ol>
                                    <li>Click <strong>+ Bag item</strong> and then replace <em>BagItem1</em> with <em>NamedLocation</em>.</li>

                                    <li>Select <strong>NamedLocation </strong>from the list.</li>

                                    <li>Select <strong>DeliveryAddress</strong> from the <strong>Extract With</strong> list.</li>
                                    <li>Enter false in the Prompt for Value field.</li>
                                    <li>Click <strong>Close</strong>.<br>
                                        <figure> <img src="./img/out_of_order_extraction.png" alt="An image of the of the NamedAddress Out of Order Extraction option." title="Import Skill Dialog">
                                            <figcaption><a href="files/time_prompts_errors.png.txt">Description
                                                    of the illustration.</a></figcaption>
                                        </figure>
                                    </li>
                                </ol>

                                <p><strong>What you just did</strong>: You've added two related entities to the composite bag that give customers the flexibility of entering the same information in two different formats. The Apache FreeMarker expression that you added for the DeliveryAddress entity enables the entity to prompt only when there's no value extracted for the NamedLocation entity. You linked the two entities by naming DeliveryAddress in the NamedLocation's <strong>Extract With</strong> option. </p>
                                <!--- Implement extract with  functionality in the dialog flow -->
                                <div>
                                    <h3>Implement the Extract With Functionality in the Dialog Flow</h3>
                                    <p>You now need to update confirmation message to output a hard-coded address only when the customer input contains <code>home</code>. </p>
                                    <ol>
                                        <li>Click <strong>Flows</strong> (<img src="./img/dialog_flow_icon.png" alt="Dialog flow editor icon" title="Dialog flow editor icon"> ) in the left navbar.</li>
                                        <li>In the showPizzaOrder state, Update confirmation message with the delivery address by adding the following Apache FreeMarker expression to the <code>text</code> property definition:<p><code>We are delivering to ${pizza.value.NamedLocation?has_content?then('Buckingham Palace, The Mall, Westminster, London SW1A 1AA',pizza.value.DeliveryAddress.originalString)}</code></p>
                                            <p>When you're done, the <code>showPizzaOrder</code> state should look like this:
                                                <pre>  showPizzaOrder:
    component: "System.Output"
    properties:
      text: "Ok, so we are getting you a ${pizza.value.PizzaSize} ${pizza.value.PizzaTopping} at
${pizza.value.DeliveryTime,date? long? number_to_time?('HH:mm')}. This will be on our ${pizza.value.PizzaDough} crust. We are delivering to ${pizza.value.NamedLocation?has_content?then('Buckingham Palace, The Mall, Westminster, London SW1A 1AA',pizza.value.DeliveryAddress.originalString)}"
    transitions: 
      return : "showPizzaOrder"</pre>
                                            </p>
                                        </li>
                                    </ol>
                                    <p><strong>What you just did:</strong> For the sake of testing,
                                        you set a hard-coded address which represents the home
                                        address for the logged in user (and for the sake of simplicity,
                                        we’ve not added a hard coded office address). The composite bag
                                        will recognize that home is a valid value and accept it. When it prompts for the address, the skill only allows a valid address, or a phrase, such as &quot;home delivery please&quot; that either includes the word <em>home</em> or one of its synonyms defined for the NamedAddress entity. </p>
                                </div>
                                <!--- Testing the extract with functionality -->
                                <div>
                                    <h3>Test the Extract With Functionality</h3>
                                    <p>Let's test how this functionality works.</p>
                                    <ol>
                                        <li>Open the Skill Tester in the left navbar.</li>
                                        <li>Enter <em>I want to order a large veggie pizza for 9pm</em>. The skill replies with &quot;What address can we send that to?&quot; (the prompt for the DeliveryAddress entity).</li>
                                        <li>Enter any address. For example, enter <em>1313 Mockingbird Lane</em>. Note that the confirmation message includes the address that you entered. Click <strong>Reset</strong>.<br>
                                        </li>
                                        <li>Enter <em>I want to order a large veggie pizza for 9pm</em> again, but when prompted for an address, enter <em>home delivery please</em>. Note that skill maps home to the hard-coded address. If you replied with something like, My mate, Dave's, an invalid value, one that's neither a NamedAddress value or an actual address, the skill prompts with &quot;What address can we send that to?&quot; until you enter an address or <em>home</em>.
                                        <li>Click <strong>Reset</strong>, then close the Tester.<br>
                                    </ol>
                                </div>
                            </section>
                            <hr>
                            <section>
                                <h2 id="section_7" role="button" style="text-align: left;"><img src="img/32_7.png" alt="section 7" class="num_circ" height="32" width="32">Enhance Error Messages</h2>
                                <p>Currently, the error message for the PizzaSize entity is static. It doesn't let the customer know what's going wrong. To output messages that reflect the incorrect user input, you need to update the entity's error message with an Apache FreeMarker expression. </p>
                                <ol>
                                    <li>Click <strong>Entities</strong> (<img src="img/entities_icon.png" alt="Entities Menu Icon" title="Entities Menu Icon">) in the left navbar and then open the PizzaBag entity.</li>

                                    <li>Select the PizzaSize entity and then click <strong>Edit</strong>.</li>

                                    <li>Update the Error Message text with the following Apache FreeMarker expression:

                                        <p><code>'${system.entityToResolve.value.userInput!'this'}'</code></p>
                                        <p>When you're done, the message will be:<br>
                                            <code>Sorry,
                                                '${system.entityToResolve.value.userInput!'this'}' is not a
                                                valid size of pizza. </code>
                                            <figure> <img src="./img/error%20message.png" alt="An image of the of the error message text pane showing the new error message for invalid pizza size." title="Error Message field">
                                                <figcaption><a href="files/error%20message.txt">Description
                                                        of the illustration.</a></figcaption>
                                            </figure>
                                        </p>
                                    </li>
                                </ol>
                                <p><strong>What you just did</strong>: You've implemented &quot;reflective listening” approach by adding the Apache FreeMaker expression with the <code>system.entityToResolve.value.userInput</code> property.</p>
                                <!--- Testing richer error message -->
                                <div>
                                    <h3>Test the Rich Error Messaging</h3>
                                    <p>Let’s do one final test. </p>
                                    <ol>
                                        <li>Open the Skill Tester from the left navbar.</li>
                                        <li>Enter <em>I want to order a veggie pizza for 9pm</em>.</li>
                                        <li>When the skills replies with the first prompt in the sequence (&quot;What size of pizza would you like?&quot;)<span class="style1"></span>, enter <em>huge</em>. Because of the <code>userInput</code> property is appended to the <code>system.entityToResolve.value</code> variable in the expression, the skill replies with "Sorry, huge is not a valid size of pizza.</em> Please choose small, medium
                                            or large pizza."</i></li>
                                    </ol>
                                    <p>Well done! Your skill can set and reset values. By validating the customer input, it's also less error-prone.</p>
                                </div>
                            </section>
                            <hr>
                            <hr>
                            <section>
                                <!-- Include the More Information section only in a standalone tutorial or in the final lab or tutorial in a series (not in a learning path) -->
                                <h2 id="more_info" role="button" style="text-align: left;"><img src="img/32_more.png" alt="more information" class="num_circ" height="32" width="32">Want
                                    to Learn More?</h2>
                                <ul>
                                    <li><a href=".html" target="_blank">More information link here</a></li>
                                    <li><a href=".html" target="_blank">More information link here</a></li>
                                    <li><a href=".html" target="_blank">More information link here</a></li>
                                    <li><a href=".html" target="_blank">More information link here</a></li>
                                </ul>
                            </section>
                            <hr>
                            </ol>
                        </div>
                    </section>
                </article>
            </div>
            <br class="clearfloat">
        </div>
    </div>
    <!--close main-->
    <!--end content-->
    <div class="footer-container ">
        <div style="max-width: 994px; padding:10px 0 0 17px;">
            <footer class="footer-list">
                <ul>
                    <li> <a href="https://www.oracle.com/corporate/index.html" target="_blank">About
                            Oracle</a> </li>
                    <li> <a href="https://www.oracle.com/us/corporate/contact/index.html" target="_blank">Contact Us</a> </li>
                    <li> <a href="https://www.oracle.com/us/legal/index.html" target="_blank">Legal
                            Notices</a> </li>
                    <li> <a href="https://www.oracle.com/us/legal/terms/index.html" target="_blank">Terms
                            of Use</a> </li>
                    <li> <a href="https://www.oracle.com/us/legal/privacy/index.html" target="_blank">Your
                            Privacy Rights</a> </li>
                    <li> <a href="https://www.oracle.com/pls/topic/lookup?ctx=cpyr&amp;id=en">Copyright
                            © 2018, Oracle and/or its affiliates. All rights reserved.</a></li>
                </ul>
            </footer>
        </div>
        <script type="text/javascript" src="https://www.oracleimg.com/us/assets/metrics/ora_docs.js"></script>
    </div>
    <!-- OBE Dialog Box code 10/15/2018 -->
    <!-- DO NOT ALTER THE CODE BELOW   -->
    <div id="lpModal" class="modal">
        <!-- Modal hdr and body -->
        <div id="obe_dialog" class="modal-content">
            <div class="modal-header"> <a href="#" class="close"> <span class="close">×</span>
                </a>
                <h1>Associated Learning Paths</h1>
            </div>
            <div id="dialog-content"> </div>
            <div id="dialog-close" class="closeBtn"> <a href="#" class="close2">
                    <p class="close2"> <span>&nbsp;&nbsp;View&nbsp;&nbsp;</span> </p>
                </a> </div>
        </div>
    </div>
    <!-- END OBE Dialog Box code -->
</body>

</html>

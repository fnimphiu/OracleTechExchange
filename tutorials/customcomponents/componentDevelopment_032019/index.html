<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Part number: Ennnnn-01 -->
    <!-- Published date: Month Year -->
    <!-- Template date: October 15, 2018 -->
    <!-- Put the content ID of this OBE between the empty quotation marks for 'content' below -->
    <meta name="contentid" content="">
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <!-- The title below is displayed on the browser tab, in search results, and in  history. It can be longer than the tutorial title in the <h1> element, below.-->
    <!-- Use an imperative verb in the title. -->
    <title>Custom Component Development and Backend Integration</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="robots" content="INDEX, FOLLOW">
    <meta name="description" content="Put the description of the tutorial here.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/normalize.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/obe-lite.css">
    <script src="js/jquery-1.11.0.min.js"></script>
    <script src="js/jquery-ui-1.10.4.custom.js"></script>
    <script src="js/jquery.tocify.jd.js"></script>
    <script src="js/leftnav.js"></script>
</head>

<body>
    <header>
        <div class="w1024" style="min-height:55px; display:block;">
            <a href="https://docs.oracle.com" class="oracle-logo"> <img src="img/oracle_doc_logo.png" alt="Oracle Documentation" style="max-width: none;" height="22" width="236"></a>
        </div>
    </header>
    <!--end header-->
    <div id="content">
        <!-- The title below is displayed as the title at the top of the OBE page. It can be shorter than the title in the <title> element, above. -->
        <!-- Use an imperative verb in the title. -->
        <h1><img src="img/obe_tag.png" align="middle" alt="Oracle by Example branding">Custom Component Development and Backend Integration</h1>
        <div class="w1024" style="clear:both; position:relative; margin-top:40px;">
            <div class="navbackwide border-right">
                <!-- -->
            </div>
            <div id="shownav" title="Show Navigation" tabindex="0"><span class="fa fa-list"></span></div>
            <div id="sidebar">
                <!-- -->
                <div class="left-nav-tut">
                    <!-- -->
                    <div id="hidenavw" title="Hide Navigation" tabindex="0"><span class="fa fa-close"></span></div>
                    <div id="navbar" class="left-nav-w">
                        <!-- -->
                        <div id="toc" class="tocify">
                            <!-- -->
                        </div>
                    </div>
                </div>
            </div>
            <div id="bookContainer">
                <article>
                    <p class="MsoNormal" style="text-align:justify"><span style="mso-ansi-language:EN-US" lang="EN-US"><b>
                                <font size="+1">Tutorial by Frank Nimphius, Oracle</font>
                            </b>
                            <br>
                            March 2019, Oracle Digital Assistant version 19.1.3<br>
                        </span></p>
                    <p style="text-align:justify">Custom components are reusable units of custom code that are added to skills in Oracle Digital Assistant to be executed at runtime in the context of a user-bot conversation. From a bot design perspective, there is only little difference between a custom component you build and system components provided by Oracle Digital Assistant.</p>
                    <p style="text-align:justify"> Integrating remote backend systems to a chatbot conversation is the most common usecase for developers to build custom components in Oracle Digital Assistant. You develop custom components using JavaScript and <a href="https://nodejs.org/en/" target="_blank"><b>Node.js</b></a>. To deploy custom components to Oracle Digital Assistant, you host them in Node.js REST services. </p>
                    <p style="text-align:justify">In this tutorial you will learn how to build custom components for deployment to Oracle Digital Assistant local Node container. Node containers in Oracle Digital Assistant are local to a skill and are deployed in a compressed file containing the custom component code along with a Node dependency file that is exected upon deployment to load and install dependent Node modules.</p>
                    <section>
                        <h2><img src="img/32_begin.png" alt="section 0" height="32" width="32" class="num_circ">Before You Begin</h2>
                        <p style="text-align:justify">Following the instructions in this tutorial, you are creating a custom component that integrates currency conversion functionality to a bot conversation. In particular, you learn</p>
                        <ul>
                            <li style="text-align:justify">How to start a new custom component service project using the Oracle Bots Node.js SDK.</li>
                            <li>How to define the custom component's name, input parameters and returned actions.</li>
                            <li style="text-align:justify">How to perform logging at runtime.</li>
                            <li style="text-align:justify">How to invoke remote REST services.</li>
                            <li style="text-align:justify">How to deploy custom component services to skills in Oracle Digital Assistant.</li>
                        </ul>
                        <h3>What Do You Need?</h3>
                        <p>This tutorial is for developers that are familiar with JavaScript and Node.js development. To complete this tutorial, the following prerequites must be met</p>
                        <ul>
                            <li>You need to have access to Oracle Digital Assistant</li>
                            <li>You need a JavaScript IDE installed. This tutorial, for example, uses <a href="https://code.visualstudio.com" target="_blank"><b>Microsoft Visual Studio Ccode</b></a> in the screen shots. If you feel comfortable using a text editor, then this is fine too. </li>
                            <li style="text-align:justify">You must have <a href="https://nodejs.org/en/" target="_blank"><b>Node.js</b></a> and Node Package Manager (NPM) installed for global access.</li>
                        </ul>
                    </section>
                    <!-- ========================================================================================================================= -->
                    <section>
                        <hr>
                        <h2 id="section_1" role="button" style="text-align: left;"><img src="img/32_1.png" alt="section 1" height="32" width="32" class="num_circ">Installing the Oracle Bots Node.js SDK</h2>
                        <p style="text-align:justify">The Oracle Bots Node.js SDK is a Node module provided and maintained by Oracle to build and deploy custom component services for Oracle Digital Assistant. You can read up about the Oracle Bots Node.js SDK on <a href="https://github.com/oracle/bots-node-sdk" target="_blank"><b>GitHub</b></a> and the <a href="https://www.npmjs.com/package/@oracle/bots-node-sdk" target="_blank"><b>Node Package Manager</b></a> website</p>
                        <p style="text-align:justify">Follow below steps to install the Oracle Node.js Bots SDK to your local machine.</p>
                        <ol>
                            <li style="text-align:justify">Open a terminal window.</li>
                            <li style="text-align:justify">If your Internet access is through a proxy, you may need to do the following in the terminal window to be able to install the Oracle Bots Node.js SDK from the Internet:
                                <ul>
                                    <li style="text-align:justify">Get the external IP address of your proxy (<a href="http://www.whatismyproxy.com/" target="_blank"><b>http://www.whatismyproxy.com/</b></a>)</li>
                                    <li style="text-align:justify">In the terminal window enter:
                                        <br>
                                        <br> <code>npm config set proxy http://external_ip:80</code>
                                        <br> <code>npm config set https-proxy http://external_ip:80</code>
                                        <br> </li>
                                </ul>
                            </li>
                            <li style="text-align:justify">To install Oracle Bots Node.js SDK, type
                                <br>
                                <br><code>npm install -g @oracle/bots-node-sdk</code>
                                <br>
                                <br> <b>Note:</b> On a MAC, you use the <i>sudo</i> command: <code>sudo npm install -g @oracle/bots-node-sdk</code> </li>
                            <li style="text-align:justify">Verify the success of your installation by typing <code>bots-node-sdk -v</code>. The command should print the Oracle Bots Node.js SDK version.</li>
                        </ol>
                    </section>
                    <hr>
                    <section>
                        <h2 id="section_2" role="button" style="text-align: left;"><img src="img/32_2.png" alt="section 2" height="32" width="32" class="num_circ">Subscribing to fixer.io</h2>
                        <p style="text-align:justify">Fixer website, <a href="https://fixer.io" target="_blank"><b>fixer.io</b></a>, offers current and historic exchange rates for up to 170 currencies. To complete this tutorial, you need a free subscription that allows you to access current conversion rates. To complete this tutorial you will need a free account to access current exchange rates.</p>
                        <ol>
                            <li style="text-align:justify">Open the <a href="https://fixer.io" target="_blank"><b>fixer.io</b></a> in a browser window.</li>
                            <li style="text-align:justify">Click on the <b>GET FREE API KEY</b> link in the upper right corner.
                                <br>
                                <figure><img src="img/fixerio_1.png" alt="GET FREE API KEY button" width="70%" height="70%"></figure>
                                <br>
                            </li>
                            <li style="text-align:justify">Click the <b>GET FREE API KEY</b> button
                                <br>
                                <figure><img src="img/fixerio_2.png" alt="Get free API key" width="70%" height="70%"></figure>
                                <br>
                            </li>
                            <li style="text-align:justify">Complete the registration form.</li>
                            <li style="text-align:justify">Copy and save the free API key displayed on the confirmation page.
                                <br>
                                <figure><img src="img/fixerio_3.png" alt="Fixer IO Confirmation page" width="70%" height="70%"></figure>
                            </li>
                        </ol>
                        <p style="text-align:justify"><b>Note: </b>The free API key does come with restrictions. For example, the currency information is updated only every hour. In addition, the base currency is Euro (EUR). The latter restriction can be handled in the custom component code so that users can use any currency as the base currency.</p>
                    </section>
                    <hr>
                    <section>
                        <h2 id="section_3" role="button" style="text-align: left;"><img src="img/32_3.png" alt="section 3" height="32" width="32" class="num_circ">Creating the Custom Component Service</h2>
                        <p style="text-align:justify">You create the custom component service project using the Oracle Bots Node.js SDK command line interface. The Oracle Bots Node.js SDK also provides all the infrastructure and tools you need to test, debug and deploy custom component services.</p>
                        <h3>Getting started</h3>
                        <ol>
                            <li style="text-align:justify">Create a new folder <b>converterccs</b> in a directory that does not contain blanks in its absolute path name.
                            <li style="text-align:justify">Open a terminal window and navigate into the <b>converterccs</b> folder
                                <br>
                                <figure><img src="img/terminal_1.png" alt="terminal window"></figure>
                            </li>
                            <li style="text-align:justify">In the <b>converterccs</b> folder, type the following commands
                                <br>
                                <ul>
                                    <li style="text-align:justify"><code>npm init -y</code></li>
                                    <li style="text-align:justify"><code>npm install -save @oracle/bots-node-sdk</code></li>
                                    <li style="text-align:justify"><code>bots-node-sdk init --component-name CurrencyConverter</code></li>
                                </ul>
                            </li>
                        </ol>
                        <p style="text-align:justify"><b>What you just did: </b> Following the instructions in this section, you created a new node project (npm init -y) in which you installed the Oracle Bots Node.js SDK. You then used the Oracle Bots Node.js command line to create your first custom component: "CurrencyConverter". Your custom component service folder structure looks as shown in the image below:
                            <br>
                            <figure><img src="img/project_1.png" alt="project structure" width="100%" height="100%"></figure>
                        </p>
                        <h3>Starting your component development</h3>
                        <p style="text-align:justify">The starter custom component generated by the Oracle Bots Node.js SDK command is equivalent to <i>"hello world"</i> and makes a great start. In this section of the tutorial you are modifying the sample code to become a shell for building the currency converter custom component.</p>
                        <ol>
                            <li style="text-align:justify">Open your JavaScript editor of choice.</li>
                            <li style="text-align:justify">In the JavaScript editor, open the <b>converterccs</b> folder as a new project
                                <figure><img src="img/jsedit_1.png" alt="JavaScript editor" width="80%" height="80%"></figure>
                                <br> <b>Note: </b>The screenshot above is from Microsoft Visual Studio Code, which supports opening folders on the file system as projects. If your JavaScript IDE does not support opening folders, then open the <code>CurrencyConverter.js</code> file located in the <i>converterccs/components</i> folder directly. </li>
                            <li style="text-align:justify">In the opened peoject folder, expand the <b>components</b> node and select the <code>CurrencyConverter.js</code>
                                <br>
                                <figure><img src="img/jsedit_2.png" alt="JS editor with opened component file" width="100%" height="100%"></figure>
                                <br>
                            </li>
                            <li style="text-align:justify">Line 5 in above image shows the following code line: <b>name: 'CurrencyConverter'</b>. Change this code line to <b>name: 'complete.training.CurrencyConverter'</b>. Adding a prefix to the component name helps avoiding naming conflicts in Oracle Digital Assistant skills that have many component services from different developers configured.</li>
                            <li style="text-align:justify">In line 7, change the string <b>human</b> to <b>variable</b>.</li>
                            <li style="text-align:justify">Create a new line below line 7 and add the following code for the base currency:
                                <br>
                                <br><code>baseCurrency: { required: true, type: 'string' },</code></li>
                            <li style="text-align:justify">Create another new line and for the target currencies. Add the following code:
                                <br>
                                <br><code>targetCurrencies: { required: true, type: 'string' },</code></li>
                            <li style="text-align:justify">Finally, create one more new line for the amount, to which you add the following code:
                                <br>
                                <br><code> amount: { required: true, type: 'int'}</code></li>
                            <li style="text-align:justify">change the following code line
                                <br>
                                <br> <code>supportedActions: ['weekday', 'weekend']</code>
                                <br>
                                <br>to
                                <br>
                                <br><code>supportedActions: ['success', 'failure']</code></li>
                            <li style="text-align:justify">With these changes, the <b>metadata: ()</b> function should look as shown in the image below:
                                <br>
                                <figure><img src="img/jsedit_3.png" alt="metadata function with the applied changes" width="100%" height="100%"></figure>
                            </li>
                            <li style="text-align:justify">Next, change the code in the <b>invoke: (conversation, done)</b> function so it looks as shown in the image below.
                                <br>
                                <figure><img src="img/jsedit_4.png" alt="invoke function" width="100%" height="100%"></figure>
                            </li>
                        </ol>
                        <p style="text-align:justify"><b>What you just did: </b> The <i>metadata</i> function describes the custom component to Oracle Digital Assistant at design time. The name prefix you added to the generated component name helps avoiding the possibility of naming clashes with other custom components. </p>
                        <p style="text-align:justify">The component properties you added define the component's input parameters that the bot designer must provide values for when adding the component to a dialog flow. The <i>variable</i> property holds a reference to a dialog flow variable the bot designer created to hold the result object returned from the custom component.</p>
                        <p style="text-align:justify">The two supportedActions, <i>success</i> and <i>failure</i>, allow the custom component to indicate to the bot dsigner whether the currency conversion succeeded or not. The bot designer uses <i>supportedActions</i> in action transitions to conditionally continue the user-bot interaction based on the component outcome.</p>
                        <p style="text-align:justify">The code lines 16, 17, 18 and 19 read-in the required component input parameters. The input parameters are flagged as required in the metadata() definition, so that missing values cause a runtime exception when testing the bot. Because of this, there is no need to check for null values in the code</p>
                        <p style="text-align:justify">The <i>done()</i> function call invokes a callback that passes the component response back to the Oracle Digital Assistant skill the custom component is configured in. </p>
                        <h3>Adding your first logging statement</h3>
                        <ol>
                            <li>Edit line 20 shown in the image above and add the following code as a single line:
                                <br>
                                <br><code>conversation.logger().info("Input parameter values: variable: "+variable+", baseCurrency: "+baseCurrency+", targetCurrencies: "+targetCurrencies+", amount: "+amount);</code></li>
                        </ol>
                        <p style="text-align:justify"><b>Note: </b>The Orackle Digital Assistant custom component service SDK exposes a configurable logger to the custom component. By default, logging is setup to use the <i>console logger</i>. This enty-level tutorial does not cover custom component debugging, so that logging become the option of choice for tracking component execution. The log statement you added prints the names and values of the component input parameters.</p>
                        <h3>Building the fixer.io request URL</h3>                        
                        <ol>
                            <li style="text-align:justify">Create a new line under the <code>conversation.logger()</code> code line.</li>
                            <li style="text-align:justify">Add the following code                                
                                <pre>
var tmpTargetCurrencies = targetCurrencies+","+baseCurrency;
var fixerIoAPIKey = "&lt;replace with your api key&gt;"
var reqUrl = "https://data.fixer.io/api/latest?"+fixerIoAPIKey+"&amp;base=EUR&amp;symbols="+tmpTargetCurrencies;
conversation.logger().info("fixer.io request URL:"+reqUrl.replace(fixerIoAPIKey,"*********"));
                            </pre>
                            </li>
                            <li style="text-align:justify">The custom component's <b>invoke</b> should now look as shown in the image below<br>
                                <figure><img src="img/jsedit_5.png" alt="component code"></figure>
                            </li>
                        </ol>
                        <p style="text-align:justify"><b>What you just did: </b> The free fixer.io subscription key only supports EUR as the base currency. To be able to still allow users to specify any currency as the base currency, the fixer.io request URL needs to contain the user specified base currency as an additional value for the target currency. The <code>replace(...)</code> function in the logging statement ensures that your fixer.io API key does not show in the log message.</p>
                        <h3>Sending the request</h3>
                        <p style="text-align:justify">In this tutorial you will use the <i>request</i> Node.js module to access the fixer.io remote REST backend services. Its important to note that there exist other Node modules, including <i>https</i> in the Node core installation for the same. The decision for using the <i>request module</i> in this tutorial is because of its ease of use. </p>
                    </section>
                    <hr>
                    <section>
                        <h2 id="section_4" role="button" style="text-align: left;"><img src="img/32_4.png" alt="section 4" height="32" width="32" class="num_circ">Step Title</h2>
                        <ol>
                            <li>...</li>
                            <li>...</li>
                        </ol>
                    </section>
                    <hr>
                    <section>
                        <h2 id="section_5" role="button" style="text-align: left;"><img src="img/32_5.png" alt="section 5" height="32" width="32" class="num_circ">Step Title</h2>
                        <ol>
                            <li>...</li>
                        </ol>
                    </section>
                    <hr>
                    <section>
                        <h2 id="section_6" role="button" style="text-align: left;"><img src="img/32_6.png" alt="section 6" height="32" width="32" class="num_circ">Step Title</h2>
                        <ol>
                            <li>...</li>
                        </ol>
                    </section>
                    <hr>
                    <section>
                        <h2 id="section_7" role="button" style="text-align: left;"><img src="img/32_7.png" alt="section 7" height="32" width="32" class="num_circ">Step Title</h2>
                        <ol>
                            <li>...</li>
                        </ol>
                    </section>
                    <hr>
                    <section>
                        <h2 id="section_8" role="button" style="text-align: left;"><img src="img/32_8.png" alt="section 8" height="32" width="32" class="num_circ">Step Title</h2>
                        <ol>
                            <li>...</li>
                        </ol>
                    </section>
                    <hr>
                    <section>
                        <!-- Include the Next section only in a lab series or tutorial series -->
                        <!-- Don't include this section if you plan to use the tutorials in a learning path -->
                        <h2 id="next" role="button" style="text-align: left;"><img src="img/32_next.png" alt="next step" height="32" width="32" class="num_circ">Next Tutorial</h2>
                        <p class="MsoNormal" style="text-align:justify"><span style="mso-ansi-language:EN-US" lang="EN-US">...</span></p>
                    </section>
                    <hr>
                    <section>
                        <!-- Include the More Information section only in a standalone tutorial or in the final lab or tutorial in a series (not in a learning path) -->
                        <h2 id="more_info" role="button" style="text-align: left;"><img src="img/32_more.png" alt="more information" height="32" width="32" class="num_circ">Want to Learn More?</h2>
                        <ul>
                            <li><a href=".html" target="_blank">More information link here</a></li>
                            <li><a href=".html" target="_blank">More information link here</a></li>
                            <li><a href=".html" target="_blank">More information link here</a></li>
                            <li><a href=".html" target="_blank">More information link here</a></li>
                        </ul>
                    </section>
                    <hr>
                </article>
            </div>
            <br class="clearfloat">
        </div>
    </div>
    <!--close main-->
    <!--end content-->
    <div class="footer-container ">
        <div style="max-width: 994px; padding:10px 0 0 17px;">
            <footer class="footer-list">
                <ul>
                    <li> <a href="https://www.oracle.com/corporate/index.html" target="_blank">About Oracle</a> </li>
                    <li> <a href="https://www.oracle.com/us/corporate/contact/index.html" target="_blank">Contact Us</a> </li>
                    <li> <a href="https://www.oracle.com/us/legal/index.html" target="_blank">Legal Notices</a> </li>
                    <li> <a href="https://www.oracle.com/us/legal/terms/index.html" target="_blank">Terms of Use</a> </li>
                    <li> <a href="https://www.oracle.com/us/legal/privacy/index.html" target="_blank">Your Privacy Rights</a> </li>
                    <li> <a href="https://www.oracle.com/pls/topic/lookup?ctx=cpyr&id=en">Copyright © 2018, Oracle and/or its affiliates. All rights reserved.</a></li>
                </ul>
            </footer>
        </div>
        <script type="text/javascript" src="https://www.oracleimg.com/us/assets/metrics/ora_docs.js"></script>
    </div>
    <!-- OBE Dialog Box code 10/15/2018 -->
    <!-- DO NOT ALTER THE CODE BELOW   -->
    <div id="lpModal" class="modal">
        <!-- Modal hdr and body -->
        <div id="obe_dialog" class="modal-content">
            <div class="modal-header">
                <a href="#" class="close"> <span class="close">&times;</span> </a>
                <h1>Associated Learning Paths</h1>
            </div>
            <div id="dialog-content"> </div>
            <div id="dialog-close" class="closeBtn">
                <a href="#" class="close2">
                    <p class="close2"> <span>&nbsp;&nbsp;View&nbsp;&nbsp;</span> </p>
                </a>
            </div>
        </div>
    </div>
    <!-- END OBE Dialog Box code -->
</body>

</html>
